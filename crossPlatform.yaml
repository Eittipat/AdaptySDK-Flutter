$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://adapty.io/crossPlatform/3.0.0/schema"
title: "Cross Platform Format"

$recuests:

  ### getSDKVersion ###

  GetSDKVersion.Request: #request
    type: object
    required: [method]
    properties:
      method: { const: "get_sdk_version" }

  GetSDKVersion.Response: #response
    type: object
    required: [success]
    properties:
      success: { type: string }

  ### isActivated ###

  IsActivated.Request: #request
    type: object
    required: [method]
    properties:
      method: { const: "is_activated" }

  IsActivated.Response: #response
    type: object
    required: [success]
    properties:
      success: { type: boolean }

  ### getLogLevel ###

  GetLogLevel.Request: #request
    type: object
    required: [method]
    properties:
      method: { const: "get_log_level" }

  GetLogLevel.Response: #response
    type: object
    required: [success]
    properties:
      success: { $ref: "#/$defs/AdaptyLog.Level" }

  ### setLogLevel ###

  SetLogLevel.Request: #request
    type: object
    required: [method, value]
    properties:
      method: { const: "set_log_level" }
      value: { $ref: "#/$defs/AdaptyLog.Level" }

  SetLogLevel.Response: #response
    type: object
    required: [success]
    properties:
      success: { const: true }

  ### activate ###
  Activate.Request: #request
    type: object
    required: [method, configuration]
    properties:
      method: { const: "activate" }
      configuration: { type: jsonString, $ref: "#/$defs/AdaptyConfiguration" } 

  Activate.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success: { const: true }

  ### getPaywall ###

  GetPaywall.Request: #request
    type: object
    required: [method, placement_id]
    properties:
      method: { const: "get_paywall" }
      placement_id: { type: string }
      locale: { type: string }
      fetch_policy: { type: jsonString, $ref: "#/$defs/AdaptyPaywall.FetchPolicy" }
      load_timeout: { type: number }

  GetPaywall.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success: { $ref: "#/$defs/AdaptyPaywall" }

  ### getPaywallProducts ###

  GetPaywallProducts.Request: #request
    type: object
    required: [method, paywall]
    properties:
      method: { const: "get_paywall_products" }
      paywall: { type: jsonString, $ref: "#/$defs/AdaptyPaywall" }

  GetPaywallProducts.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success:
            { type: array, items: { $ref: "#/$defs/AdaptyPaywallProduct" } }

  ### getProfile ###

  GetProfile.Request: #request
    type: object
    required: [method]
    properties:
      method: { const: "get_profile" }

  GetProfile.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success: { $ref: "#/$defs/AdaptyProfile" }

  ### updateProfile ###

  UpdateProfile.Request: #request
    type: object
    required: [method, params]
    properties:
      method: { const: "update_profile" }
      params: { type: jsonString, $ref: "#/$defs/AdaptyProfileParameters" }

  UpdateProfile.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success: { const: true }

  ### identify ###

  Identify.Request: #request
    type: object
    required: [method, customer_user_id]
    properties:
      method: { const: "identify" }
      customer_user_id: { type: string }

  Identify.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success: { const: true }

  ### logout ###

  Logout.Request: #request
    type: object
    required: [method]
    properties:
      method: { const: "logout" }

  Logout.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success: { const: true }

  ### logShowOnboarding ###

  LogShowOnboarding.Request: #request
    type: object
    required: [method, params]
    properties:
      method: { const: "log_show_onboarding" }
      params: { type: jsonString, $ref: "#/$defs/AdaptyOnboardingScreenParameters" }

  LogShowOnboarding.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success: { const: true }

  ### logShowPaywall ###

  LogShowPaywall.Request: #request
    type: object
    required: [method, paywall]
    properties:
      method: { const: "log_show_paywall" }
      paywall: { type: jsonString, $ref: "#/$defs/AdaptyPaywall" }

  LogShowPaywall.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success: { const: true }

  ### makePurchase ###

  MakePurchase.Request: #request
    type: object
    required: [method, product]
    properties:
      method: { const: "make_purchase" }
      product: { type: jsonString, $ref: "#/$defs/AdaptyPaywallProduct.Request" }

  MakePurchase.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success: { $ref: "#/$defs/AdaptyPurchaseResult" }

  ### restorePurchases ###

  RestorePurchases.Request: #request
    type: object
    required: [method]
    properties:
      method: { const: "restore_purchases" }

  RestorePurchases.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success: { $ref: "#/$defs/AdaptyProfile" }

  ### setFallbackPaywalls ###

  SetFallbackPaywalls.Request: #request
    type: object
    required: [method, file_url]
    properties:
      method: { const: "set_fallback_paywalls" }
      file_url: { type: string }

  SetFallbackPaywalls.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success: { const: true }

  ### setVariationId ###

  SetVariationId.Request: #request
    type: object
    required: [method, variation_id, transaction_id]
    properties:
      method: { const: "set_variation_id" }
      variation_id: { type: string }
      transaction_id: { type: string }

  SetVariationId.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success: { const: true }

  ### updateAttribution ###

  UpdateAttribution.Request: #request
    type: object
    required: [method, attribution, source]
    properties:
      method: { const: "update_attribution" }
      attribution: { type: jsonString }
      source: { $ref: "#/$defs/AdaptyAttributionSource" }
      network_user_id: { type: string }

  UpdateAttribution.Response: #response
    type: object
    oneOf:
      - required: [error]
        properties:
          error: { $ref: "#/$defs/AdaptyError" }
      - required: [success]
        properties:
          success: { const: true }

  ### presentCodeRedemptionSheet ###

  PresentCodeRedemptionSheet.Request: #request
    type: object
    required: [method]
    properties:
      method: { const: "present_code_redemption_sheet" }

  PresentCodeRedemptionSheet.Response: #response
    type: object
    required: [success]
    properties:
      success: { const: true }

$defs:
  ### Entities ###

  AdaptyError: #response
    type: object
    required: [adapty_code, message]
    properties:
      adapty_code: { type: integer }
      message: { type: string }
      detail: { type: string }
      
  AdaptyLog.Level: #request #response
    type: string
    enum:
      - error
      - warn
      - info
      - verbose
      - debug

  Date: #response
    type: string
    format: "yyyy-MM-dd'T'HH:mm:ss.SSSZ"

  AdaptyConfiguration.ServerCluster: #request
    type: string
    enum:
      - eu
      - default

  AdaptyConfiguration: #request
    type: object

  AdaptyPaywallProduct.Response: #response
    type: object

  AdaptyPaywallProduct.Request: #request
    type: object

  AdaptyOnboardingScreenParameters: #request
    type: object

  AdaptyPaywall: #request #response
    type: object

  AdaptyPaywall.FetchPolicy: #request
    type: object

  AdaptyPaywall.RemoteConfig:  #request #response
    type: object

  AdaptySubscriptionPeriod: #response
    type: object

  AdaptySubscriptionPeriod.Unit: #response
    type: string
    enum:
        - day
        - week
        - month
        - year
        - unknown

  AdaptyProfile: #response
    type: object

  AdaptyProfile.AccessLevel: #response
    type: object

  AdaptyProfile.NonSubscription: #response
    type: object

  AdaptyProfile.Subscription: #response
    type: object

  AdaptyProfile.Gender: #request
    type: string
    enum:
      - f
      - m
      - o
    description: |
      * `f` - female
      * `m` - male
      * `o` - other

  AdaptyProfileParameters: #request
    type: object

  AdaptySubscriptionOffer: #response
    type: object

  AdaptySubscriptionOffer.OfferType: #response
    type: string
    enum:
      - introductory
      - promotional
      - winBack

  AdaptySubscriptionOffer.PaymentMode: #response
    type: string
    enum:
      - pay_as_you_go
      - pay_up_front
      - free_trial
      - unknown

  AdaptyAttributionSource: #request
    type: string
    enum:
      - adjust
      - appsflyer
      - branch
      - custom

  AdaptyPurchaseResult: #response
    type: object


